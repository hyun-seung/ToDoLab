<!-- src/main/resources/templates/pages/task/month.html -->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:inline="html">

<div class="px-5 py-6">

    <!-- 상단 월 이동 -->
    <div class="flex items-center justify-between mb-4">
        <a class="nav-btn"
           th:href="'/tasks/month?move=prev&month=' + ${yearMonth}"
           aria-label="이전 달">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 19l-7-7 7-7" />
            </svg>
        </a>

        <div class="text-sm font-semibold text-gray-700"
             th:text="${yearMonth.getYear()} + '년 ' + ${yearMonth.getMonthValue()} + '월'">
            2025년 12월
        </div>

        <a class="nav-btn"
           th:href="'/tasks/month?move=next&month=' + ${yearMonth}"
           aria-label="다음 달">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 5l7 7-7 7" />
            </svg>
        </a>
    </div>

    <!-- ✅ 요일 헤더: 일 ~ 토 -->
    <div class="grid grid-cols-7 gap-2 text-xs text-gray-500 mb-2 px-1">
        <div class="text-center text-red-600">일</div>
        <div class="text-center">월</div>
        <div class="text-center">화</div>
        <div class="text-center">수</div>
        <div class="text-center">목</div>
        <div class="text-center">금</div>
        <div class="text-center text-blue-600">토</div>
    </div>

    <!-- 캘린더 그리드 (6 x 7) -->
    <div class="grid grid-cols-7 gap-2">

        <!-- 날짜 셀: 넓은 영역 클릭 시 day 이동 -->
        <a th:each="cell : ${cells}"
           th:href="'/tasks/day?date=' + ${cell.date()}"
           class="block bg-white rounded-xl shadow-sm p-2 min-h-[110px] border
                  hover:shadow-md hover:-translate-y-[1px] transition month-cell"
           th:classappend="${!cell.inMonth()} ? ' opacity-50' : ''">

            <!-- 날짜 / 오늘 표시 -->
            <div class="flex items-center justify-between mb-1">
                <div class="text-sm font-semibold"
                     th:text="${cell.date().getDayOfMonth()}">
                    1
                </div>

                <div th:if="${cell.date().equals(today)}"
                     class="text-[10px] px-2 py-[2px] rounded-full bg-blue-600 text-white">
                    오늘
                </div>
            </div>

            <!-- 일정 목록 (최대 3개) -->
            <div class="space-y-1">
                <div th:each="task, stat : ${cell.tasks()}"
                     th:if="${stat.index < 3}"
                     class="text-[11px] rounded-md px-2 py-1 truncate cursor-pointer
                            hover:brightness-95 active:scale-[0.99] transition task-chip"
                     th:attr="data-task-id=${task.id()}"
                     th:style="'background:' + ${task.color()}"
                     onclick="return openTaskDetailFromMonth(event, this);">
                    <span th:text="${task.title()}">일정 제목</span>
                </div>

                <div th:if="${cell.tasks().size() > 3}"
                     class="text-[11px] text-gray-500 px-1">
                    <span th:text="'+' + (${cell.tasks().size()} - 3) + ' more'">
                        +2 more
                    </span>
                </div>
            </div>

        </a>
    </div>

</div>

<style>
    .month-cell { overflow: hidden; }
    .task-chip  { box-shadow: 0 6px 14px rgba(0,0,0,0.10); }
</style>

<script>
    function openTaskDetailFromMonth(event, el) {
        event.preventDefault();
        event.stopPropagation();

        const taskId = el?.getAttribute?.("data-task-id");
        if (!taskId) return false;

        if (typeof DetailModal !== "undefined" && DetailModal?.loadDetail) {
            DetailModal.loadDetail(taskId);
        }
        return false;
    }
</script>

</html>
