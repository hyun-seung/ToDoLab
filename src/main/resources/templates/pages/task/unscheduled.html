<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:inline="html">

<div class="px-5 py-6" id="unscheduled-page">

    <!-- 상단 타이틀 (미니멀) -->
    <div class="flex items-center justify-center mb-5">
        <div class="text-xl font-bold text-gray-900">미정</div>
    </div>

    <!-- 로딩/에러/리스트 영역 -->
    <div id="unscheduledState" class="text-sm text-gray-500 mb-3 hidden"></div>

    <div id="unscheduledList" class="space-y-4"></div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
      const listEl = document.getElementById("unscheduledList");
      const stateEl = document.getElementById("unscheduledState");

      const showState = (msg) => {
        stateEl.textContent = msg;
        stateEl.classList.remove("hidden");
      };

      const hideState = () => stateEl.classList.add("hidden");

      const renderEmpty = () => {
        listEl.innerHTML = `
          <div class="empty-state">
            미정 일정이 없습니다
          </div>
        `;
      };

      const escapeHtml = (s) => (s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll("\"", "&quot;")
        .replaceAll("'", "&#039;");

      try {
        showState("불러오는 중...");

        const res = await fetch("/api/tasks/unscheduled", {
          headers: { "Accept": "application/json" }
        });

        if (!res.ok) {
          showState("미정 일정을 불러오지 못했습니다.");
          return;
        }

        const json = await res.json();
        const tasks = json?.data ?? [];

        hideState();

        if (!tasks.length) {
          renderEmpty();
          return;
        }

        listEl.innerHTML = tasks.map(t => {
          const title = escapeHtml(t.title);
          const desc = escapeHtml(t.description);

          // color가 API에 없으면 기존 알고리즘 쓰거나, 고정색/카테고리 기반으로 바꿔도 됨
          const color = "#C4B5FD";

          return `
            <div class="task-card cursor-pointer hover:shadow-md hover:bg-gray-50 transition"
                 data-task-id="${t.id}">
              <div class="p-4">
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0">
                    <div class="font-bold text-gray-900 truncate">${title}</div>
                    ${desc ? `<div class="mt-1 text-sm text-gray-600 line-clamp-2">${desc}</div>` : ``}
                  </div>
                  <span class="time-badge" style="background:${color}">
                    미정
                  </span>
                </div>
              </div>
            </div>
          `;
        }).join("");

        // ✅ 클릭하면 기존 DetailModal 로직 재사용 (base.html에 이미 전역 click 바인딩 있음)
        // (data-task-id만 붙이면 자동으로 열림)
      } catch (e) {
        showState("네트워크 오류로 미정 일정을 불러오지 못했습니다.");
      }
    });
</script>

</html>
