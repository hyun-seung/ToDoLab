<!-- src/main/resources/templates/pages/task/week.html -->
<div th:fragment="content"
     id="week-page"
     class="px-4 pb-24 max-w-3xl mx-auto"
     th:attr="data-current-date=${currentDate},
              data-selected-date=${selectedDate}">

    <!-- 상단 헤더 -->
    <div class="relative mt-4">
        <a id="weekPrevBtn"
           th:href="'/tasks/week?move=prev&date=' + ${currentDate}"
           class="w-10 h-10 flex items-center justify-center rounded-2xl bg-white border border-gray-200
                  shadow-[0_10px_24px_rgba(17,24,39,0.06)]
                  font-black text-gray-900 select-none transition active:scale-[0.98] hover:bg-gray-50
                  absolute left-0 top-1/2 -translate-y-1/2"
           aria-label="지난주">←</a>

        <a id="weekNextBtn"
           th:href="'/tasks/week?move=next&date=' + ${currentDate}"
           class="w-10 h-10 flex items-center justify-center rounded-2xl bg-white border border-gray-200
                  shadow-[0_10px_24px_rgba(17,24,39,0.06)]
                  font-black text-gray-900 select-none transition active:scale-[0.98] hover:bg-gray-50
                  absolute right-0 top-1/2 -translate-y-1/2"
           aria-label="다음주">→</a>

        <div class="flex flex-col items-center text-center px-14">
            <div class="text-sm font-semibold text-gray-800">주간 일정</div>
            <div id="weekRangeText"
                 class="mt-2 text-[12px] text-gray-400 font-semibold"
                 th:text="${weekRange}">2026-01-25 ~ 2026-01-31</div>
        </div>
    </div>

    <!-- 요일/날짜 -->
    <div class="mt-6">
        <div id="weekDow"
             class="grid grid-cols-7 text-center text-[11px] font-semibold text-gray-500">
            <button type="button" class="text-red-500 select-none py-1" data-idx="0">일</button>
            <button type="button" class="select-none py-1" data-idx="1">월</button>
            <button type="button" class="select-none py-1" data-idx="2">화</button>
            <button type="button" class="select-none py-1" data-idx="3">수</button>
            <button type="button" class="select-none py-1" data-idx="4">목</button>
            <button type="button" class="select-none py-1" data-idx="5">금</button>
            <button type="button" class="text-blue-500 select-none py-1" data-idx="6">토</button>
        </div>

        <div id="weekStrip"
             class="mt-1.5 grid grid-cols-7 text-center"
             th:with="today=${T(java.time.LocalDate).now()}">

            <a th:each="day : ${weeklyTasks}"
               href="#"
               th:attr="data-date=${day.date},
                        data-has=${#lists.isEmpty(day.tasks) ? '0' : '1'}"
               class="group flex flex-col items-center justify-center py-[2px] rounded-lg select-none cursor-pointer
                      transition hover:bg-black/[0.03] active:scale-[0.99] active:bg-black/[0.045]
                      focus:outline-none focus-visible:ring-4 focus-visible:ring-indigo-500/20">

                <div class="relative w-9 h-9 rounded-full flex items-center justify-center transition"
                     th:classappend="${day.date.equals(selectedDate)} ? ' bg-indigo-500 shadow-[0_10px_18px_rgba(99,102,241,0.20)] -translate-y-[1px]' : ''">

                    <span th:if="${day.date.equals(today)}"
                          class="absolute -inset-[2px] rounded-full border-2 border-indigo-500/55 pointer-events-none"
                          th:classappend="${day.date.equals(selectedDate)} ? ' border-white/85' : ''"></span>

                    <span class="text-[14px] font-black leading-none text-gray-900"
                          th:classappend="${day.date.equals(selectedDate)} ? ' text-white' : ''"
                          th:text="${day.date.dayOfMonth}">30</span>
                </div>

                <div class="mt-1 w-1.5 h-1.5 rounded-full bg-indigo-500/70 transition"
                     th:classappend="${#lists.isEmpty(day.tasks)} ? ' opacity-0' : ' opacity-100'"></div>
            </a>
        </div>
    </div>

    <!-- 날짜별 일정 -->
    <div id="weekDays" class="mt-8 space-y-3">

        <div th:each="day : ${weeklyTasks}"
             class="week-day"
             th:attr="data-date=${day.date}"
             th:classappend="${day.date.equals(selectedDate)} ? '' : ' hidden'">

            <!-- 일정 없음 -->
            <div th:if="${#lists.isEmpty(day.tasks)}" class="flex justify-center mt-8">
                <div class="w-full border border-dashed border-gray-300 rounded-[22px] p-10 text-center bg-white/35">
                    <div class="text-2xl">📭</div>
                    <div class="mt-3 text-xl font-extrabold text-gray-800">등록된 일정이 없어요</div>
                    <div class="mt-1 text-sm text-gray-500 font-semibold">필요한 일부터 하나씩 추가해보세요</div>
                </div>
            </div>

            <!-- 일정 리스트 (✅ day/unscheduled와 같은 카드 스타일) -->
            <div th:unless="${#lists.isEmpty(day.tasks)}" class="space-y-3">
                <div th:each="t : ${day.tasks}"
                     class="task-card task-card-clickable"
                     th:attr="data-task-id=${t.id}">

                    <div class="task-row">
                        <div class="task-left-bar" style="background: rgba(99, 102, 241, 0.55);"></div>
                        <div class="check-box">✓</div>

                        <div class="min-w-0 flex-1">
                            <div class="flex items-center gap-2 min-w-0">
                                <div class="task-title truncate"
                                     th:text="${t.title}">제목</div>

                                <span th:if="${t.category != null and !#strings.isEmpty(t.category)}"
                                      class="task-badge"
                                      th:text="${t.category}"></span>
                            </div>

                            <div th:if="${t.description != null and !#strings.isEmpty(t.description)}"
                                 class="task-desc mt-1 line-clamp-2"
                                 th:text="${t.description}">설명</div>
                        </div>

                        <div class="task-right"
                             th:text="${t.allDay} ? '종일' : (${t.time} != null ? ${#temporals.format(t.time,'HH:mm')} : '')">
                            종일
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
